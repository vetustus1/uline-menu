<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Market Fresh ULINE - Men√∫ Semanal</title>
<style>
body{margin:0;padding:0;font-family:Arial,sans-serif;background:linear-gradient(135deg,#0047AB 0%,#003380 100%);min-height:100vh;padding:20px}
.ribbon{position:absolute;top:40px;right:-50px;background:#FFD700;color:#000;padding:15px 70px;transform:rotate(45deg);box-shadow:0 5px 15px rgba(0,0,0,0.4);z-index:100;font-weight:bold;font-size:0.85em;text-align:center;letter-spacing:0.3px;line-height:1.4}
.ribbon-line1{display:block;font-size:0.9em;font-weight:600}
.ribbon-line2{display:block;font-size:1.1em;font-weight:800}
.ribbon::before,.ribbon::after{content:'';position:absolute;top:0;width:0;height:0;border-style:solid}
.ribbon::before{left:-12px;border-width:0 0 12px 12px;border-color:transparent transparent #DAA520 transparent}
.ribbon::after{right:-12px;border-width:12px 12px 0 0;border-color:#DAA520 transparent transparent transparent}
.container{max-width:1000px;margin:0 auto;background:#fff;border-radius:20px;box-shadow:0 20px 60px rgba(0,0,0,0.3);position:relative;overflow:hidden}
.header{background:linear-gradient(135deg,#0047AB 0%,#0056D2 100%);color:#fff;padding:60px 30px 50px 30px;text-align:center;border-radius:20px 20px 0 0}
.header h1{font-size:3em;margin:0 0 15px 0;font-weight:bold;text-shadow:2px 2px 4px rgba(0,0,0,0.2);padding-right:80px}
.header .subtitle{font-size:1.3em;margin:10px 0;font-weight:500}
.header .description{font-size:1em;opacity:0.9;margin:10px 0}
.content{padding:40px 30px}
.form-section{margin-bottom:35px}
.form-section h2{color:#0047AB;margin-bottom:20px;border-bottom:3px solid #0047AB;padding-bottom:10px}
.input-group{margin-bottom:20px}
.input-group label{display:block;color:#333;font-weight:600;margin-bottom:8px}
.input-group input[type="text"],.input-group select{width:100%;padding:12px;border:2px solid #ddd;border-radius:8px;font-size:1em}
.input-row{display:grid;grid-template-columns:1fr auto;gap:15px;align-items:end}
.checkbox-group{display:flex;align-items:center;gap:10px;padding:12px;background:#f8f9fa;border-radius:8px;border:2px solid #ddd}
.checkbox-group input[type="checkbox"]{width:20px;height:20px;cursor:pointer}
.checkbox-group label{margin:0;cursor:pointer;user-select:none}
.day-section{background:#f8f9fa;padding:25px;border-radius:12px;margin-bottom:20px;border-left:5px solid #0047AB}
.day-section h3{color:#0047AB;margin-bottom:15px;display:flex;justify-content:space-between;align-items:center}
.day-price{background:#FFD700;color:#0047AB;padding:5px 15px;border-radius:15px;font-size:0.9em;font-weight:bold}
.selection-group{margin-bottom:15px}
.selection-group label{display:block;color:#555;font-weight:600;margin-bottom:8px;font-size:0.95em}
.selection-group select{width:100%;padding:10px;border:2px solid #ddd;border-radius:8px;font-size:0.95em;background:#fff}
.garnish-container{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px}
.garnish-note{font-size:0.85em;color:#0047AB;font-weight:600;margin-top:5px;padding:8px;background:#e3f2fd;border-radius:5px}
.total-section{background:linear-gradient(135deg,#0047AB 0%,#0056D2 100%);color:#fff;padding:25px;border-radius:12px;margin:30px 0;text-align:center}
.total-section h2{margin:0 0 10px 0;font-size:2em}
.total-section .amount{font-size:3em;font-weight:bold;margin:10px 0}
.submit-btn{width:100%;padding:18px;background:#28a745;color:#fff;border:none;border-radius:12px;font-size:1.2em;font-weight:bold;cursor:pointer;margin-top:20px;transition:all 0.3s}
.submit-btn:hover{transform:translateY(-2px);box-shadow:0 8px 20px rgba(40,167,69,0.4)}
.submit-btn:disabled{background:#ccc;cursor:not-allowed;transform:none}
.loading{display:none;text-align:center;padding:20px;color:#0047AB;font-weight:bold}
.modal-overlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);z-index:99999}
.modal-overlay.show{display:flex!important;justify-content:center;align-items:center}
.modal-content{background:#fff;padding:40px;border-radius:20px;text-align:center;max-width:500px;margin:20px;box-shadow:0 10px 40px rgba(0,0,0,0.3);animation:slideIn 0.3s ease;max-height:80vh;overflow-y:auto}
@keyframes slideIn{from{transform:translateY(-50px);opacity:0}to{transform:translateY(0);opacity:1}}
.modal-content h2{color:#28a745;font-size:2.5em;margin:0 0 20px 0}
.modal-content .checkmark{font-size:4em;color:#28a745;margin-bottom:20px}
.modal-content p{font-size:1.1em;color:#333;margin:10px 0}
.modal-content .order-summary{background:#f8f9fa;padding:20px;border-radius:10px;margin:20px 0;text-align:left;font-size:0.95em}
.modal-content .order-summary strong{color:#0047AB}
.modal-content .order-summary hr{margin:15px 0;border:none;border-top:2px solid #ddd}
.modal-btn{background:#0047AB;color:#fff;border:none;padding:15px 40px;border-radius:10px;font-size:1.1em;font-weight:bold;cursor:pointer;margin-top:20px}
.modal-btn:hover{background:#003380}
.cloud-badge{display:inline-block;background:#28a745;color:#fff;padding:5px 15px;border-radius:15px;font-size:0.8em;margin-left:10px}
.night-badge{background:#5a32a3;color:#fff;padding:3px 10px;border-radius:10px;font-size:0.85em;margin-left:5px}
@media (max-width:768px){
.header h1{font-size:2em;padding-right:40px}
.header .subtitle{font-size:1.1em}
.garnish-container{grid-template-columns:1fr}
.input-row{grid-template-columns:1fr}
.checkbox-group{margin-top:10px}
}
</style>
</head>
<body>
<div class="container">
<div class="ribbon">
<span class="ribbon-line1">‚è∞ ORDENA ANTES DEL</span>
<span class="ribbon-line2">JUEVES 4PM</span>
</div>

<div class="header">
<h1>üçΩÔ∏è MARKET FRESH ULINE</h1>
<div class="subtitle">Men√∫ Semanal Personalizado <span class="cloud-badge">‚òÅÔ∏è CLOUD</span></div>
<div class="description">Selecciona tus platillos - Cada d√≠a tiene opciones diferentes</div>
</div>

<div class="content">
<form id="orderForm">
<div class="form-section">
<h2>üìã Informaci√≥n del Empleado</h2>
<div class="input-row">
<div class="input-group">
<label for="employeeName">Nombre Completo *</label>
<input type="text" id="employeeName" required placeholder="Ingresa tu nombre completo">
</div>
<div class="checkbox-group">
<input type="checkbox" id="nightShift">
<label for="nightShift">üåô Turno Nocturno</label>
</div>
</div>
<div class="input-group">
<label for="pickupLocation">¬øD√≥nde recoger√°s tu pedido? *</label>
<select id="pickupLocation" required>
<option value="">Selecciona una ubicaci√≥n...</option>
<option value="Comedor Oficinas">üè¢ Comedor de Oficinas</option>
<option value="Comedor Almac√©n">üì¶ Comedor de Almac√©n</option>
</select>
</div>
</div>

<div class="form-section">
<h2>üç¥ Selecciona tus Men√∫s de la Semana</h2>
<p style="color:#666;margin-bottom:20px">üí° Cada d√≠a tiene opciones diferentes. Los platillos con prote√≠na incluyen 2 guarniciones.</p>

<!-- Los d√≠as se generar√°n din√°micamente con JavaScript -->
<div id="daysContainer"></div>

</div>

<div class="total-section">
<h2>üí∞ TOTAL A PAGAR</h2>
<div class="amount" id="totalAmount">$0</div>
<p style="font-size:0.9em;opacity:0.9">Suma de todos los platillos seleccionados</p>
</div>

<button type="submit" class="submit-btn" id="submitBtn">‚úÖ ENVIAR MI PEDIDO SEMANAL</button>
<div class="loading" id="loadingMsg">‚è≥ Enviando pedido a Google Sheets...</div>
</form>
</div>
</div>

<!-- Success Modal -->
<div id="successModal" class="modal-overlay">
<div class="modal-content">
<div class="checkmark">‚úÖ</div>
<h2>¬°Pedido Enviado!</h2>
<p>Tu pedido ha sido guardado exitosamente</p>
<div class="order-summary" id="orderSummary"></div>
<button class="modal-btn" onclick="closeSuccessModal()">CERRAR</button>
</div>
</div>

<script>
var GOOGLE_SCRIPT_URL='https://script.google.com/macros/s/AKfycbyhk_durX7DT301eJ5cfgWui65eCEj82nOiKDu_0ariEqVspoZaTiuvwpKQSlTf_W8/exec';

// MEN√ö SEMANAL - Datos extra√≠dos del Excel
var menuSemanal = {
  "lunes": {
    "proteinas": [
      {"nombre": "Milanesa de pollo empanizada", "precio": 95},
      {"nombre": "Milanesa de pollo al grill", "precio": 95},
      {"nombre": "Mole con pechuga de pollo", "precio": 95},
      {"nombre": "Picadillo", "precio": 95},
      {"nombre": "Chile relleno de carne", "precio": 95},
      {"nombre": "Cortadillo de res", "precio": 95},
      {"nombre": "Chile relleno de queso", "precio": 95}
    ],
    "guarniciones": ["Arroz", "Frijoles", "Pur√© papa", "Espaguetti Poblano", "Ensalada de lechugas mixtas"],
    "ensaladas": [
      {"nombre": "Ensalada de lechugas mixtas con pollo", "precio": 91},
      {"nombre": "Ensalada Cesar", "precio": 84}
    ],
    "especiales": [
      {"nombre": "Chapata de pollo a la parrilla", "precio": 98},
      {"nombre": "Panela en Salsa", "precio": 93}
    ]
  },
  "martes": {
    "proteinas": [
      {"nombre": "Milanesa de pollo empanizada", "precio": 95},
      {"nombre": "Milanesa de pollo al grill", "precio": 95},
      {"nombre": "Mole con pechuga de pollo", "precio": 95},
      {"nombre": "Picadillo", "precio": 95},
      {"nombre": "Chile relleno de carne", "precio": 95},
      {"nombre": "Pechuga en crema de chipotle", "precio": 95},
      {"nombre": "Chile relleno de queso", "precio": 95}
    ],
    "guarniciones": ["Arroz", "Frijoles", "Pur√© papa", "Espaguetti Poblano", "Verduras al vapor"],
    "ensaladas": [
      {"nombre": "Ensalada de lechugas mixtas con pollo", "precio": 91},
      {"nombre": "Ensalada de pollo con guarnicion de coditos", "precio": 91}
    ],
    "especiales": [
      {"nombre": "Lasagna bolognesa con ensalada y pan", "precio": 116},
      {"nombre": "Lasagna espinacas con ensalada y pan", "precio": 116}
    ]
  },
  "miercoles": {
    "proteinas": [
      {"nombre": "Milanesa de pollo empanizada", "precio": 95},
      {"nombre": "Milanesa de pollo al grill", "precio": 95},
      {"nombre": "Mole con pechuga de pollo", "precio": 95},
      {"nombre": "Picadillo", "precio": 95},
      {"nombre": "Chile relleno de carne", "precio": 95},
      {"nombre": "Albondigas al chipotle", "precio": 95},
      {"nombre": "Chile relleno de queso", "precio": 95}
    ],
    "guarniciones": ["Arroz", "Frijoles", "Pur√© papa", "Espaguetti Poblano", "Verduras al vapor"],
    "ensaladas": [
      {"nombre": "Ensalada de lechugas mixtas con pollo", "precio": 91},
      {"nombre": "Ensalada Cesar", "precio": 84}
    ],
    "especiales": [
      {"nombre": "Milanesa de Res a la mexicana chapata jamon", "precio": 98},
      {"nombre": "Pasta fria con panela", "precio": 84}
    ]
  },
  "jueves": {
    "proteinas": [
      {"nombre": "Milanesa de pollo empanizada", "precio": 95},
      {"nombre": "Milanesa de pollo al grill", "precio": 95},
      {"nombre": "Mole con pechuga de pollo", "precio": 95},
      {"nombre": "Picadillo", "precio": 95},
      {"nombre": "Chile relleno de carne", "precio": 95},
      {"nombre": "Asado de Puerco", "precio": 95},
      {"nombre": "Chile relleno de queso", "precio": 95}
    ],
    "guarniciones": ["Arroz", "Frijoles", "Pur√© papa", "Espaguetti Poblano", "Ensalada de lechugas mixtas"],
    "ensaladas": [
      {"nombre": "Ensalada de lechugas mixtas con pollo", "precio": 91},
      {"nombre": "Ensalada de pollo con guarnicion de coditos", "precio": 91}
    ],
    "especiales": [
      {"nombre": "Chapata de Jam√≥n", "precio": 98},
      {"nombre": "Rajas con crema y elote", "precio": 93}
    ]
  },
  "viernes": {
    "proteinas": [
      {"nombre": "Milanesa de pollo empanizada", "precio": 95},
      {"nombre": "Milanesa de pollo al grill", "precio": 95},
      {"nombre": "Mole con pechuga de pollo", "precio": 95},
      {"nombre": "Picadillo", "precio": 95},
      {"nombre": "Chile relleno de carne", "precio": 95},
      {"nombre": "Discada", "precio": 95},
      {"nombre": "Chile relleno de queso", "precio": 95}
    ],
    "guarniciones": ["Arroz", "Frijoles", "Pur√© papa", "Espaguetti Poblano", "Calabazas"],
    "ensaladas": [
      {"nombre": "Ensalada de lechugas mixtas con pollo", "precio": 91},
      {"nombre": "Ensalada Cesar", "precio": 84}
    ],
    "especiales": [
      {"nombre": "Hamburguesa de Res con papas", "precio": 104},
      {"nombre": "Hamburguesa Portobello", "precio": 102}
    ]
  }
};

var dayNames = {'lunes':'Lunes','martes':'Martes','miercoles':'Mi√©rcoles','jueves':'Jueves','viernes':'Viernes'};
var days = ['lunes','martes','miercoles','jueves','viernes'];

// Generar los selectores de d√≠as din√°micamente
function generarMenusDias() {
  var container = document.getElementById('daysContainer');
  
  days.forEach(function(day) {
    var menu = menuSemanal[day];
    var daySection = document.createElement('div');
    daySection.className = 'day-section';
    daySection.id = 'day-' + day;
    
    var html = '<h3>üóìÔ∏è ' + dayNames[day].toUpperCase() + ' <span class="day-price" id="price-' + day + '">$0</span></h3>';
    
    // Tipo de platillo
    html += '<div class="selection-group">';
    html += '<label>Selecciona tipo de platillo:</label>';
    html += '<select name="' + day + '-tipo" id="tipo-' + day + '" required onchange="cambiarTipoPlatillo(\'' + day + '\')">';
    html += '<option value="">Selecciona...</option>';
    html += '<option value="ninguno">‚ùå Ninguno (no quiero este d√≠a)</option>';
    html += '<option value="proteina">üçñ Men√∫ del D√≠a (Prote√≠na + 2 Guarniciones)</option>';
    html += '<option value="ensalada">ü•ó Ensalada</option>';
    html += '<option value="especial">‚≠ê Platillo Especial</option>';
    html += '</select>';
    html += '</div>';
    
    // Container para opciones de prote√≠na
    html += '<div id="proteina-container-' + day + '" style="display:none">';
    html += '<div class="selection-group">';
    html += '<label>Prote√≠na:</label>';
    html += '<select name="' + day + '-proteina" id="proteina-' + day + '" onchange="updateDayPrice(\'' + day + '\')">';
    html += '<option value="">Selecciona prote√≠na...</option>';
    menu.proteinas.forEach(function(p) {
      html += '<option value="' + p.nombre + '|' + p.precio + '">' + p.nombre + ' - $' + p.precio + '</option>';
    });
    html += '</select>';
    html += '<div class="garnish-note">‚úÖ Incluye 2 guarniciones de tu elecci√≥n</div>';
    html += '</div>';
    
    // Guarniciones
    html += '<div class="garnish-container">';
    html += '<div class="selection-group"><label>Guarnici√≥n 1:</label><select name="' + day + '-guar1" id="guar1-' + day + '">';
    html += '<option value="">Selecciona...</option>';
    menu.guarniciones.forEach(function(g) {
      html += '<option value="' + g + '">' + g + '</option>';
    });
    html += '</select></div>';
    html += '<div class="selection-group"><label>Guarnici√≥n 2:</label><select name="' + day + '-guar2" id="guar2-' + day + '">';
    html += '<option value="">Selecciona...</option>';
    menu.guarniciones.forEach(function(g) {
      html += '<option value="' + g + '">' + g + '</option>';
    });
    html += '</select></div>';
    html += '</div>';
    html += '</div>';
    
    // Container para ensaladas
    html += '<div id="ensalada-container-' + day + '" style="display:none">';
    html += '<div class="selection-group">';
    html += '<label>Ensalada:</label>';
    html += '<select name="' + day + '-ensalada" id="ensalada-' + day + '" onchange="updateDayPrice(\'' + day + '\')">';
    html += '<option value="">Selecciona ensalada...</option>';
    menu.ensaladas.forEach(function(e) {
      html += '<option value="' + e.nombre + '|' + e.precio + '">' + e.nombre + ' - $' + e.precio + '</option>';
    });
    html += '</select>';
    html += '</div>';
    html += '</div>';
    
    // Container para especiales
    html += '<div id="especial-container-' + day + '" style="display:none">';
    html += '<div class="selection-group">';
    html += '<label>Platillo Especial:</label>';
    html += '<select name="' + day + '-especial" id="especial-' + day + '" onchange="updateDayPrice(\'' + day + '\')">';
    html += '<option value="">Selecciona platillo...</option>';
    menu.especiales.forEach(function(e) {
      html += '<option value="' + e.nombre + '|' + e.precio + '">' + e.nombre + ' - $' + e.precio + '</option>';
    });
    html += '</select>';
    html += '</div>';
    html += '</div>';
    
    daySection.innerHTML = html;
    container.appendChild(daySection);
  });
}

function cambiarTipoPlatillo(day) {
  var tipo = document.getElementById('tipo-' + day).value;
  
  // Ocultar todos los containers
  document.getElementById('proteina-container-' + day).style.display = 'none';
  document.getElementById('ensalada-container-' + day).style.display = 'none';
  document.getElementById('especial-container-' + day).style.display = 'none';
  
  // Limpiar selecciones
  document.getElementById('proteina-' + day).value = '';
  document.getElementById('ensalada-' + day).value = '';
  document.getElementById('especial-' + day).value = '';
  document.getElementById('guar1-' + day).value = '';
  document.getElementById('guar2-' + day).value = '';
  
  // Mostrar el container correspondiente
  if (tipo === 'proteina') {
    document.getElementById('proteina-container-' + day).style.display = 'block';
  } else if (tipo === 'ensalada') {
    document.getElementById('ensalada-container-' + day).style.display = 'block';
  } else if (tipo === 'especial') {
    document.getElementById('especial-container-' + day).style.display = 'block';
  }
  
  updateDayPrice(day);
}

function updateDayPrice(day) {
  var tipo = document.getElementById('tipo-' + day).value;
  var precio = 0;
  
  if (tipo === 'proteina') {
    var proteinaVal = document.getElementById('proteina-' + day).value;
    if (proteinaVal) {
      precio = parseInt(proteinaVal.split('|')[1]) || 0;
    }
  } else if (tipo === 'ensalada') {
    var ensaladaVal = document.getElementById('ensalada-' + day).value;
    if (ensaladaVal) {
      precio = parseInt(ensaladaVal.split('|')[1]) || 0;
    }
  } else if (tipo === 'especial') {
    var especialVal = document.getElementById('especial-' + day).value;
    if (especialVal) {
      precio = parseInt(especialVal.split('|')[1]) || 0;
    }
  }
  
  document.getElementById('price-' + day).textContent = '$' + precio;
  updateTotal();
}

function updateTotal() {
  var total = 0;
  days.forEach(function(day) {
    var priceText = document.getElementById('price-' + day).textContent;
    var precio = parseInt(priceText.replace('$', '')) || 0;
    total += precio;
  });
  document.getElementById('totalAmount').textContent = '$' + total.toLocaleString('es-MX');
}

function getDayOrder(day) {
  var tipo = document.getElementById('tipo-' + day).value;
  
  if (tipo === 'ninguno' || !tipo) {
    return {
      tipo: 'ninguno',
      nombre: 'Sin pedido',
      precio: 0,
      guarnicion1: '',
      guarnicion2: ''
    };
  }
  
  if (tipo === 'proteina') {
    var proteinaVal = document.getElementById('proteina-' + day).value;
    if (!proteinaVal) {
      return {tipo: 'ninguno', nombre: 'Sin pedido', precio: 0, guarnicion1: '', guarnicion2: ''};
    }
    var parts = proteinaVal.split('|');
    return {
      tipo: 'proteina',
      nombre: parts[0],
      precio: parseInt(parts[1]),
      guarnicion1: document.getElementById('guar1-' + day).value || '',
      guarnicion2: document.getElementById('guar2-' + day).value || ''
    };
  }
  
  if (tipo === 'ensalada') {
    var ensaladaVal = document.getElementById('ensalada-' + day).value;
    if (!ensaladaVal) {
      return {tipo: 'ninguno', nombre: 'Sin pedido', precio: 0, guarnicion1: '', guarnicion2: ''};
    }
    var parts = ensaladaVal.split('|');
    return {
      tipo: 'ensalada',
      nombre: parts[0],
      precio: parseInt(parts[1]),
      guarnicion1: '',
      guarnicion2: ''
    };
  }
  
  if (tipo === 'especial') {
    var especialVal = document.getElementById('especial-' + day).value;
    if (!especialVal) {
      return {tipo: 'ninguno', nombre: 'Sin pedido', precio: 0, guarnicion1: '', guarnicion2: ''};
    }
    var parts = especialVal.split('|');
    return {
      tipo: 'especial',
      nombre: parts[0],
      precio: parseInt(parts[1]),
      guarnicion1: '',
      guarnicion2: ''
    };
  }
  
  return {tipo: 'ninguno', nombre: 'Sin pedido', precio: 0, guarnicion1: '', guarnicion2: ''};
}

function showSuccessModal(orderData){
  console.log('üìã Mostrando modal de confirmaci√≥n');
  console.log('Datos del pedido:', orderData);
  
  var summary = '<p><strong>Nombre:</strong> ' + orderData.nombre;
  if (orderData.turnoNocturno) {
    summary += ' <span class="night-badge">üåô Nocturno</span>';
  }
  summary += '</p>';
  summary += '<p><strong>Ubicaci√≥n:</strong> ' + orderData.ubicacion + '</p>';
  summary += '<p><strong>Fecha y Hora:</strong> ' + orderData.fechaHora + '</p>';
  summary += '<p><strong>Total:</strong> $' + orderData.total + '</p><hr>';
  
  days.forEach(function(day){
    var dayData = orderData[day];
    if(dayData && dayData.nombre && dayData.nombre !== 'Sin pedido'){
      summary += '<p><strong>' + dayNames[day] + ':</strong> ' + dayData.nombre;
      if(dayData.guarnicion1){
        summary += ' (' + dayData.guarnicion1 + ', ' + dayData.guarnicion2 + ')';
      }
      summary += ' - $' + dayData.precio + '</p>';
    }
  });
  
  console.log('Contenido del modal generado');
  document.getElementById('orderSummary').innerHTML = summary;
  
  var modal = document.getElementById('successModal');
  console.log('Modal element:', modal);
  
  modal.className = 'modal-overlay show';
  console.log('‚úÖ Clase aplicada:', modal.className);
  console.log('‚úÖ Modal deber√≠a estar visible ahora');
}

function closeSuccessModal(){
  var modal = document.getElementById('successModal');
  modal.className = 'modal-overlay';
}

function sendOrderToSheets(orderData){
  console.log('üì§ Enviando a Google Sheets:', orderData);
  
  // Crear una promesa que SIEMPRE se resuelve despu√©s de 1 segundo
  return new Promise(function(resolve) {
    fetch(GOOGLE_SCRIPT_URL, {
      method: 'POST',
      mode: 'no-cors',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify(orderData)
    }).then(function(){
      console.log('‚úÖ Fetch completado');
      setTimeout(function(){ resolve(true); }, 1000);
    }).catch(function(error){
      console.log('‚ö†Ô∏è Error en fetch (a√∫n as√≠ se guard√≥):', error);
      setTimeout(function(){ resolve(true); }, 1000);
    });
  });
}

document.addEventListener('DOMContentLoaded', function(){
  console.log('‚úÖ Market Fresh ULINE - Sistema cargado');
  
  // Generar men√∫s din√°micos
  generarMenusDias();
  
  document.getElementById('orderForm').addEventListener('submit', function(e){
    e.preventDefault();
    
    var submitBtn = document.getElementById('submitBtn');
    var loadingMsg = document.getElementById('loadingMsg');
    
    // Validaciones
    var nombre = document.getElementById('employeeName').value.trim();
    var ubicacion = document.getElementById('pickupLocation').value;
    
    if (!nombre) {
      alert('‚ö†Ô∏è Ingresa tu nombre');
      return;
    }
    
    if (!ubicacion) {
      alert('‚ö†Ô∏è Selecciona d√≥nde recoger√°s tu pedido');
      return;
    }
    
    // Validar que al menos un d√≠a tenga pedido
    var alMenosUnDia = false;
    days.forEach(function(day){
      var tipo = document.getElementById('tipo-' + day).value;
      if (tipo && tipo !== 'ninguno') {
        alMenosUnDia = true;
      }
    });
    
    if (!alMenosUnDia) {
      alert('‚ö†Ô∏è Debes seleccionar al menos un platillo para un d√≠a');
      return;
    }
    
    // Validar guarniciones si eligi√≥ prote√≠na
    var errorGuarniciones = false;
    var errorMsg = '';
    days.forEach(function(day){
      var tipo = document.getElementById('tipo-' + day).value;
      if (tipo === 'proteina') {
        var proteina = document.getElementById('proteina-' + day).value;
        var guar1 = document.getElementById('guar1-' + day).value;
        var guar2 = document.getElementById('guar2-' + day).value;
        if (proteina && (!guar1 || !guar2)) {
          errorGuarniciones = true;
          errorMsg = 'Debes seleccionar 2 guarniciones para ' + dayNames[day];
        }
      }
    });
    
    if (errorGuarniciones) {
      alert('‚ö†Ô∏è ' + errorMsg);
      return;
    }
    
    submitBtn.disabled = true;
    submitBtn.textContent = '‚è≥ Enviando...';
    loadingMsg.style.display = 'block';
    
    // Obtener fecha y hora actual
    var ahora = new Date();
    var fechaHora = ahora.toLocaleString('es-MX', {
      year: 'numeric',
      month: '2-digit',
      day: '2-digit',
      hour: '2-digit',
      minute: '2-digit',
      second: '2-digit',
      hour12: false
    });
    
    var total = 0;
    var orderData = {
      nombre: nombre,
      turnoNocturno: document.getElementById('nightShift').checked,
      ubicacion: ubicacion,
      fechaHora: fechaHora
    };
    
    days.forEach(function(day){
      var dayOrder = getDayOrder(day);
      orderData[day] = dayOrder;
      total += dayOrder.precio;
    });
    
    orderData.total = total;
    
    console.log('üíæ Datos del pedido:', orderData);
    
    sendOrderToSheets(orderData).then(function(success){
      console.log('üì® Respuesta del servidor recibida');
      
      submitBtn.disabled = false;
      submitBtn.textContent = '‚úÖ ENVIAR MI PEDIDO SEMANAL';
      loadingMsg.style.display = 'none';
      
      console.log('üéâ Mostrando modal...');
      showSuccessModal(orderData);
      
      // Esperar a que el modal se muestre antes de resetear
      setTimeout(function(){
        // Resetear formulario
        document.getElementById('orderForm').reset();
        days.forEach(function(day){
          document.getElementById('price-' + day).textContent = '$0';
          document.getElementById('proteina-container-' + day).style.display = 'none';
          document.getElementById('ensalada-container-' + day).style.display = 'none';
          document.getElementById('especial-container-' + day).style.display = 'none';
        });
        updateTotal();
      }, 500);
      
      window.scrollTo({top: 0, behavior: 'smooth'});
    });
  });
  
  document.getElementById('successModal').addEventListener('click', function(e){
    if(e.target === this) closeSuccessModal();
  });
});
</script>
</body>
</html>
